<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Mapa Hali - Jasna Szałwia</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fbfcfb; /* Prawie białe tło strony */
      text-align: center;
      padding: 20px;
      color: #444;
    }
    #map-container {
      background: white;
      border: none;
      display: inline-block;
      box-shadow: 0 10px 40px rgba(0,0,0,0.05);
      border-radius: 12px;
      padding: 15px;
      margin-top: 20px;
    }
    .btn {
      background: #9dbf9e; /* Jasna, świeża szałwia */
      color: white;
      border: none;
      padding: 14px 30px;
      cursor: pointer;
      border-radius: 10px;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    .btn:hover {
      background: #89ad8a;
      transform: translateY(-1px);
    }
    h2 { color: #6a856c; font-weight: 400; letter-spacing: 1px; }
  </style>
</head>
<body>

<h2>Mapa Rozkładu Stoisk</h2>
<button class="btn" onclick="downloadSVG()">POBIERZ MAPĘ (SVG)</button>
<br>
<div id="map-container"></div>

<script>
  // Rozjaśniona paleta kolorystyczna
  const COLORS = {
    premium: "#b2d8b7",  // Świeża, jasna szałwia
    normal1: "#cfe1cf",  // Bardzo jasny miętowy
    normal2: "#deeadb",  // Pastelowa zieleń
    normal3: "#ebf2ea",  // Prawie biała zieleń
    small1:  "#bedec2",  // Jasny seledyn
    small2:  "#d6e6d1",  // Mleczna oliwka
    tech:    "#f2f4f2"   // Neutralny, bardzo jasny szary
  };

  const STROKE_COLOR = "#8ba38d"; // Rozjaśniony kontur stoisk

  function cleanText(txt) {
    if (!txt) return "";
    let t = txt.replace(/Socjalne|\/ Entrance/gi, "");
    t = t.replace(/Przejście toalety/gi, "Do toalet");
    return t.trim();
  }

  function wrapTextSmarter(text, sw, fontSize) {
    const avgCharW = fontSize * 0.55;
    const maxChars = Math.floor(sw / avgCharW);
    if (text.length <= maxChars) return [text];
    let words = text.split(' ');
    let lines = [];
    let currentLine = words[0];
    for (let i = 1; i < words.length; i++) {
      if ((currentLine + " " + words[i]).length <= maxChars) {
        currentLine += " " + words[i];
      } else {
        lines.push(currentLine);
        currentLine = words[i];
      }
    }
    lines.push(currentLine);
    return lines;
  }

  const data = [{"id":"mgl5iw69-apfj5ox","index":"a1","type":"other","width":3,"height":3,"color":"tech","description":"Wejście / Entrance","start":{"row":82,"col":46},"end":{"row":87,"col":51}},{"id":"mgl5l1dd-638vrn7","index":"a0","type":"other","width":5,"height":3,"color":"tech","description":"Wejście dla wystawców","start":{"row":0,"col":0},"end":{"row":5,"col":12}},{"id":"mgl5ldw7-35aihnp","index":"S1","type":"standard","width":3.5,"height":3,"color":"normal1","start":{"row":0,"col":13},"end":{"row":5,"col":19},"vendor":"Lusia Knits"},{"id":"mgl5lmv2-rf2z8vs","index":"S2","type":"standard","width":3.5,"height":3,"color":"normal2","start":{"row":0,"col":20},"end":{"row":5,"col":26},"vendor":"Biferno"},{"id":"mgl5mosd-zy7ymt5","index":"S3","type":"standard","width":3.5,"height":3,"color":"normal1","start":{"row":0,"col":27},"end":{"row":5,"col":33},"vendor":"Biferno"},{"id":"mgl5mz0x-9lgguya","index":"S4","type":"standard","width":3.5,"height":3,"color":"normal2","start":{"row":0,"col":34},"end":{"row":5,"col":40},"vendor":"Luka Ceramika & Paciorkowce i Wisielce"},{"id":"mgl5ogvq-pqucf09","index":"P1","type":"premium","width":5.5,"height":3,"color":"premium","start":{"row":0,"col":41},"end":{"row":5,"col":51},"vendor":"Dye Dye Done"},{"id":"mgl60s92-lscpjj7","index":"P2","type":"premium","width":3,"height":5.5,"color":"premium","start":{"row":11,"col":46},"end":{"row":21,"col":51},"vendor":"Strikke"},{"id":"mgl613ar-ngm5blq","index":"S5","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":22,"col":46},"end":{"row":28,"col":51},"vendor":"Wełna Bawełna"},{"id":"mgl618tt-1yiapaw","index":"S6","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":29,"col":46},"end":{"row":35,"col":51},"vendor":"Wełna Bawełna"},{"id":"mgl64q1f-x7w94p5","index":"S7","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":36,"col":46},"end":{"row":42,"col":51},"vendor":"Time to Knit"},{"id":"mgl64v4d-yqddbkl","index":"S8","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":43,"col":46},"end":{"row":49,"col":51},"vendor":"Kokonki"},{"id":"mgl6517j-mjhaicf","index":"S9","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":50,"col":46},"end":{"row":56,"col":51},"vendor":"Kokonki"},{"id":"mgl65aou-ptdjo6e","index":"S10","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":57,"col":46},"end":{"row":63,"col":51},"vendor":"Martin's Lab"},{"id":"mgl65qbi-2kfiih9","index":"P3","type":"premium","width":3,"height":5.5,"color":"premium","start":{"row":64,"col":46},"end":{"row":74,"col":51},"vendor":"Liloppi"},{"id":"mgl66pt4-1ygebgf","index":"S11","type":"standard","width":3.5,"height":3,"color":"normal1","start":{"row":82,"col":39},"end":{"row":87,"col":45},"vendor":"Gabo Wool"},{"id":"mgl68zf8-rfy5hgh","index":"C1","type":"standard","width":3,"height":4,"color":"normal3","start":{"row":80,"col":0},"end":{"row":87,"col":5},"vendor":"Centrum Włóczek Bafpol"},{"id":"mgl6econ-j4mlyk8","index":"S15","type":"standard","width":3.5,"height":3,"color":"normal1","start":{"row":82,"col":6},"end":{"row":87,"col":12},"vendor":"Centrum Włóczek Bafpol"},{"id":"mgl6ektc-rbbbi4w","index":"S14","type":"standard","width":3.5,"height":3,"color":"normal2","start":{"row":82,"col":13},"end":{"row":87,"col":19},"vendor":"Brioszka"},{"id":"mgl6et3j-e9giz38","index":"S13","type":"standard","width":3.5,"height":3,"color":"normal1","start":{"row":82,"col":20},"end":{"row":87,"col":26},"vendor":"Brioszka"},{"id":"mgl6fi1f-6o60rka","index":"A2","type":"other","width":2.5,"height":3,"color":"tech","description":"Przejście toalety","start":{"row":82,"col":27},"end":{"row":87,"col":31}},{"id":"mgl6fuog-0pibcjv","index":"S12","type":"standard","width":3.5,"height":3,"color":"normal2","start":{"row":82,"col":32},"end":{"row":87,"col":38},"vendor":"Gabo Wool"},{"id":"mgl6kh0d-1jnqs8s","index":"P5","type":"premium","width":3,"height":5.5,"color":"premium","start":{"row":11,"col":1},"end":{"row":21,"col":6},"vendor":"Motkomania"},{"id":"mgl6l031-6oufobz","index":"S21","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":22,"col":1},"end":{"row":28,"col":6},"vendor":"WoolMorning"},{"id":"mgl6l6xj-wvxnju7","index":"S20","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":29,"col":1},"end":{"row":35,"col":6},"vendor":"Yarnpower"},{"id":"mgl6lej8-i38l6td","index":"S19","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":36,"col":1},"end":{"row":42,"col":6},"vendor":"Dziergaweczki"},{"id":"mgl6lzj5-6kpu2mj","index":"S18","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":43,"col":1},"end":{"row":49,"col":6},"vendor":"Miss Knitski"},{"id":"mgl6mdh4-mwhosiw","index":"S17","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":50,"col":1},"end":{"row":56,"col":6},"vendor":"Pimotki"},{"id":"mgl6mkfw-8hallfi","index":"S16","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":57,"col":1},"end":{"row":63,"col":6},"vendor":"Pimotki"},{"id":"mgl6n8xv-mczs30e","index":"A3","type":"other","width":4,"height":0.5,"color":"tech","description":"Socjalne","start":{"row":64,"col":1},"end":{"row":64,"col":6}},{"id":"mgl6nkta-rs38jfz","index":"P4","type":"premium","width":3,"height":5.5,"color":"premium","start":{"row":65,"col":1},"end":{"row":75,"col":6},"vendor":"Włóczykijki"},{"id":"mgl6ush4-p91myjt","index":"M1","type":"mini","width":2,"height":3,"color":"small1","start":{"row":15,"col":15},"end":{"row":20,"col":18},"vendor":"Włóczkotki"},{"id":"mgl6v4gk-ouwx9zh","index":"M2","type":"mini","width":2,"height":3,"color":"small2","start":{"row":21,"col":15},"end":{"row":26,"col":18},"vendor":"Mokosza"},{"id":"mgl6vc2j-3qc7l5j","index":"M3","type":"mini","width":2,"height":3,"color":"small1","start":{"row":27,"col":15},"end":{"row":32,"col":18},"vendor":"Winter Bee Candle"},{"id":"mgl6wf6b-2ayxfbb","index":"S22","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":15,"col":26},"end":{"row":21,"col":31},"vendor":"Mila Druciarnia"},{"id":"mgl6wl89-uat4n17","index":"S23","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":15,"col":32},"end":{"row":21,"col":37},"vendor":"Sama se uszyj"},{"id":"mgl6wrxx-idnr7z0","index":"S24","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":22,"col":26},"end":{"row":28,"col":31},"vendor":"Mila Druciarnia"},{"id":"mgl6wwic-tvap3dc","index":"S27","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":29,"col":32},"end":{"row":35,"col":37},"vendor":"Animotki"},{"id":"mgl6x1b7-40fayv0","index":"S25","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":22,"col":32},"end":{"row":28,"col":37},"vendor":"Woolloop"},{"id":"mgl6x7j0-3q74q4a","index":"S26","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":29,"col":26},"end":{"row":35,"col":31},"vendor":"Hanka mi zrobiła"},{"id":"mgl6yx3j-a6gbbdv","index":"S28","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":44,"col":15},"end":{"row":50,"col":20},"vendor":"Furora Yarns"},{"id":"mgl6z2cb-1uxwbpm","index":"S29","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":44,"col":21},"end":{"row":50,"col":26},"vendor":"The Knitting Box"},{"id":"mgl6zbss-39u5b6d","index":"S30","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":51,"col":15},"end":{"row":57,"col":20},"vendor":"Furora Yarns"},{"id":"mgl6zfsg-fr2jl43","index":"S31","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":51,"col":21},"end":{"row":57,"col":26},"vendor":"Mania Chomikuje"},{"id":"mgl6zjh0-jwq4ubf","index":"S32","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":58,"col":15},"end":{"row":64,"col":20},"vendor":"7oczek"},{"id":"mgl6zxpt-k5hpk88","index":"S33","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":58,"col":21},"end":{"row":64,"col":26},"vendor":"Ale masz to cudne & Koło Kniei"},{"id":"mgl71r2j-qkagdvk","index":"S34","type":"standard","width":3,"height":3.5,"color":"normal1","start":{"row":65,"col":15},"end":{"row":71,"col":20},"vendor":"7oczek"},{"id":"mgl71yd5-znghfel","index":"S35","type":"standard","width":3,"height":3.5,"color":"normal2","start":{"row":65,"col":21},"end":{"row":71,"col":26},"vendor":"Floral Fiber Fusion & Halbanka"},{"id":"mgl72tsa-qs2e7an","index":"M7","type":"mini","width":2,"height":3,"color":"small2","start":{"row":66,"col":34},"end":{"row":71,"col":37},"vendor":"Wydawnictwo RM"},{"id":"mgl76hx7-qw6e0d0","index":"M6","type":"mini","width":2,"height":3,"color":"small1","start":{"row":60,"col":34},"end":{"row":65,"col":37},"vendor":"Okki Handmade"},{"id":"mgl76tw7-mgn1xq1","index":"M5","type":"mini","width":2,"height":3,"color":"small2","start":{"row":54,"col":34},"end":{"row":59,"col":37},"vendor":"Agna Wool Art"},{"id":"mgl775wk-c5g9xg2","index":"M4","type":"mini","width":2,"height":3,"color":"small1","start":{"row":48,"col":34},"end":{"row":53,"col":37},"vendor":"Szklarka"}];

  function draw() {
    const scale = 13;
    const pad = 25;
    const w = 55 * scale + pad*2;
    const h = 90 * scale + pad*2;

    let svg = `<svg id="hall-svg" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg" style="background:white; border-radius: 4px;">`;

    data.forEach(s => {
      const x = s.start.col * scale + pad;
      const y = s.start.row * scale + pad;
      const sw = (s.end.col - s.start.col + 1) * scale;
      const sh = (s.end.row - s.start.row + 1) * scale;
      const name = cleanText(s.vendor || s.description || "");
      const showIndex = !s.index.toLowerCase().startsWith('a');

      let fontSize = 13;
      let lines = wrapTextSmarter(name, sw - 2, fontSize);

      while (fontSize > 4.5) {
        let blockH = (showIndex ? fontSize : 0) + (lines.length * (fontSize * 1.1));
        let maxLineChars = Math.max(...lines.map(l => l.length));
        let maxW = maxLineChars * fontSize * 0.55;
        if (blockH < sh - 1 && maxW < sw - 1) break;
        fontSize -= 0.3;
        lines = wrapTextSmarter(name, sw - 1, fontSize);
      }

      // RYSOWANIE STOISKA (rx=5 dla nieco mocniejszego, ale miękkiego zaokrąglenia)
      svg += `<rect x="${x}" y="${y}" width="${sw}" height="${sh}" rx="5" ry="5" fill="${COLORS[s.color]}" stroke="${STROKE_COLOR}" stroke-width="0.5" />`;

      if (name || showIndex) {
        const totalH = (showIndex ? fontSize : 0) + (lines.length * fontSize);
        let curY = y + (sh - totalH) / 2 + fontSize * 0.8;

        if (showIndex) {
          svg += `<text x="${x+sw/2}" y="${curY}" text-anchor="middle" font-size="${fontSize}" font-weight="bold" fill="#333" font-family="Arial">${s.index}</text>`;
          curY += fontSize;
        }

        svg += `<text x="${x+sw/2}" y="${curY}" text-anchor="middle" font-size="${fontSize}" fill="#444" font-family="Arial">`;
        lines.forEach((l, i) => {
          svg += `<tspan x="${x+sw/2}" dy="${i === 0 ? "0" : "1.1em"}">${l}</tspan>`;
        });
        svg += `</text>`;
      }
    });

    svg += `</svg>`;
    document.getElementById('map-container').innerHTML = svg;
  }

  function downloadSVG() {
    const content = document.getElementById('map-container').innerHTML;
    const blob = new Blob([content], {type: 'image/svg+xml'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'mapa_hali_jasna.svg';
    a.click();
    URL.revokeObjectURL(url);
  }

  draw();
</script>
</body>
</html>
